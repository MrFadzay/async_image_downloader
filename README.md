# Async Image Downloader and Processor

Этот проект представляет собой асинхронный инструмент командной строки для скачивания изображений и управления дубликатами. Он поддерживает как автоматизированный режим через аргументы командной строки, так и интерактивный режим для удобного использования человеком.

![alt text](async_image_downloader.gif)

## Быстрый старт

### Вариант 1: Готовый исполняемый файл
1. Скачайте последнюю версию программы из раздела [Releases](https://github.com/mrfadzay/async_image_downloader/releases)
2. Распакуйте архив в любую папку
3. Запустите `image_tool.exe`
4. Следуйте инструкциям в интерактивном меню

### Вариант 2: Запуск из исходного кода
1. Клонируйте репозиторий: `git clone https://github.com/mrfadzay/async_image_downloader.git`
2. Установите зависимости: `pip install -r requirements.txt`
3. Запустите программу: `python async_image_downloader.py`

## Проблема

При работе с наполнением сайтов, интернет-магазинов или блогов контент-менеджеры часто сталкиваются с необходимостью скачивать сотни изображений из разных источников. Этот процесс включает в себя:
*   Ручное скачивание каждого файла.
*   Сортировку изображений по папкам.
*   Поиск и удаление визуально одинаковых картинок, которые могут быть загружены под разными именами или из разных источников.
*   Необходимость сделать изображения "уникальными" для поисковых систем, избегая санкций за дублированный контент.

Эти задачи отнимают много времени и подвержены человеческим ошибкам.

## Решение

**Async Image Downloader** автоматизирует весь этот процесс. Это консольный инструмент, который позволяет:

*   **Массово скачивать изображения** по списку URL из файла или напрямую из командной строки.
*   **Автоматически находить визуальные дубликаты** с помощью перцептивного хеширования и переименовывать их для дальнейшей проверки.
*   **"Уникализировать" дубликаты** путем внесения незначительных изменений (яркость, контраст, обрезка), которые делают файл технически уникальным, но сохраняют его визуальное качество.

Инструмент имеет два режима работы, что делает его удобным как для ручного использования, так и для интеграции в автоматизированные скрипты.

## Последние изменения

### Версия 1.1.0
- Добавлена поддержка нового формата файлов с URL (ссылки в столбик)
- Улучшено определение дубликатов с использованием трех алгоритмов хеширования
- Исправлена проблема с перезаписью одинаковых ссылок
- Улучшена нумерация дубликатов
- Добавлена поддержка кириллических имен папок
- Исправлена обработка путей с пробелами и специальными символами

## Особенности

*   **Асинхронное скачивание:** Эффективно скачивает изображения из списка URL или из файла, содержащего URL.
*   **Обработка дубликатов:**
    *   **Поиск и переименование:** Находит дубликаты изображений на основе комбинации трех алгоритмов хеширования и переименовывает их, добавляя суффикс `_duplicate_N`.
    *   **Уникализация:** Модифицирует дубликаты изображений (изменяя яркость, контраст, обрезку или добавляя шум), чтобы сделать их уникальными, сохраняя при этом визуальное сходство.
*   **Два режима работы:**
    *   **Режим командной строки (CLI):** Идеально подходит для автоматизации, использования в скриптах, cron-задачах или CI/CD пайплайнах.
    *   **Интерактивный режим:** Удобное меню с подсказками для ручного использования, не требующее запоминания всех флагов.
*   **Предотвращение перезаписи файлов:** При скачивании одинаковых ссылок программа не перезаписывает файлы, а добавляет счетчик к имени файла.
*   **Поддержка кириллицы:** Корректная работа с кириллическими именами папок и путями, содержащими пробелы.

## Установка

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/mrfadzay/async_image_downloader.git
    cd async_image_downloader
    ```

2.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```
    или вручную:
    ```bash
    pip install aiohttp aiofiles Pillow imagehash questionary
    ```

3.  **Создание исполняемого файла (опционально):**
    ```bash
    pip install pyinstaller
    pyinstaller image_tool.spec
    ```
    Исполняемый файл будет создан в папке `dist`.

## Форматы файлов с URL

Программа поддерживает два формата файлов с URL:

### Формат 1: Имя папки и URL в одной строке
```
папка 1 https://example.com/img1.jpg https://example.com/img2.png
папка 2 https://example.com/img3.jpg
```

### Формат 2: Имя папки в отдельной строке, URL в следующих строках
```
папка 3
https://example.com/img4.jpg
https://example.com/img5.png
```

## Использование

### Интерактивный режим

Просто запустите скрипт без каких-либо аргументов, и он предложит вам выбрать действие:

```bash
python async_image_downloader.py
```

Или запустите исполняемый файл:

```bash
image_tool.exe
```

Вы увидите меню с опциями:
*   Скачать изображения
*   Найти и переименовать дубликаты
*   Уникализировать дубликаты
*   Выход

Скрипт будет задавать дополнительные вопросы в зависимости от вашего выбора.

### Режим командной строки (CLI)

Вы можете использовать следующие команды с аргументами для автоматизации задач:

#### 1. Скачивание изображений

*   **Из файла с URL:**
    Создайте файл (например, `url.txt`) в одном из поддерживаемых форматов.
    Затем запустите команду:
    ```bash
    python async_image_downloader.py download --file url.txt
    ```

*   **По списку URL:**
    Скачать изображения по списку URL, указанных непосредственно в команде. Вы можете указать папку назначения с помощью флага `-d` или `--dest`.
    ```bash
    python async_image_downloader.py download --urls https://example.com/img1.jpg https://example.com/img2.png --dest my_downloads
    ```

#### 2. Поиск и переименование дубликатов

Эта команда найдет дубликаты изображений в указанной директории и переименует их, добавляя суффикс `_duplicate_N`.

```bash
python async_image_downloader.py find-duplicates images/my_downloads
```
*(Замените `images/my_downloads` на путь к вашей директории)*

#### 3. Уникализация дубликатов

Эта команда найдет дубликаты изображений в указанной директории и попытается модифицировать их, чтобы сделать уникальными.

```bash
python async_image_downloader.py uniquify images/my_downloads
```
*(Замените `images/my_downloads` на путь к вашей директории)*

## Как это работает

Проект использует `asyncio` для асинхронных операций ввода-вывода, таких как скачивание файлов, что позволяет эффективно обрабатывать множество URL одновременно. 

Для определения дубликатов используется комбинация трех алгоритмов хеширования из библиотеки `imagehash`:
- perceptual hash (phash)
- difference hash (dhash)
- average hash (average_hash)

Изображение считается дубликатом, если как минимум 2 из 3 хешей совпадают. Это позволяет находить визуально похожие изображения с высокой точностью, даже если они были слегка изменены.

При уникализации дубликатов программа применяет несколько модификаций одновременно (яркость, контраст, обрезка, добавление шума), что повышает шанс сделать изображение уникальным с первой попытки.

## Планы на будущее

В будущих версиях планируется:
- Конвертация инструмента в веб-приложение с использованием FastAPI
- Добавление графического интерфейса для более удобного использования
- Расширение функциональности по обработке изображений

## Лицензия

Этот проект распространяется под лицензией MIT. См. файл `LICENSE` для получения дополнительной информации.